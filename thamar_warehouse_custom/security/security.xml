<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Groups -->
    <record id="group_warehouse_keeper" model="res.groups">
        <field name="name">Warehouse Keeper</field>
        <field name="implied_ids" eval="[(4, ref('stock.group_stock_user'))]"/>
    </record>

    <record id="group_warehouse_manager" model="res.groups">
        <field name="name">Warehouse Manager</field>
        <field name="implied_ids" eval="[(4, ref('group_warehouse_keeper'))]"/>
    </record>

    <!-- Record Rules for Warehouse -->
    <record id="rule_warehouse_keeper_see_own" model="ir.rule">
        <field name="name">Warehouse Keeper: See Own Warehouses</field>
        <field name="model_id" ref="stock.model_stock_warehouse"/>
        <field name="domain_force">['|', ('keeper_id', '=', user.id), ('manager_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_warehouse_keeper'))]"/>
    </record>

    <!-- Record Rules for Stock Picking -->
    <record id="rule_stock_picking_keeper_see_own" model="ir.rule">
        <field name="name">Warehouse Keeper/Manager: See Own Pickings</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="domain_force">['|', ('picking_type_id.warehouse_id.keeper_id', '=', user.id), ('picking_type_id.warehouse_id.manager_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_warehouse_keeper'))]"/>
    </record>

    <!-- Record Rules for Stock Move -->
    <record id="rule_stock_move_keeper_see_own" model="ir.rule">
        <field name="name">Warehouse Keeper/Manager: See Own Moves</field>
        <field name="model_id" ref="stock.model_stock_move"/>
        <field name="domain_force">['|', '|', ('picking_id.picking_type_id.warehouse_id.keeper_id', '=', user.id), ('picking_id.picking_type_id.warehouse_id.manager_id', '=', user.id), ('warehouse_id.keeper_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_warehouse_keeper'))]"/>
    </record>

    <!-- Record Rules for Stock Quant -->
    <record id="rule_stock_quant_keeper_see_own" model="ir.rule">
        <field name="name">Warehouse Keeper/Manager: See Own Quants</field>
        <field name="model_id" ref="stock.model_stock_quant"/>
        <field name="domain_force">['|', ('location_id.warehouse_id.keeper_id', '=', user.id), ('location_id.warehouse_id.manager_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_warehouse_keeper'))]"/>
    </record>

    <!-- Record Rules for Stock Location -->
    <record id="rule_stock_location_keeper_see_own" model="ir.rule">
        <field name="name">Warehouse Keeper/Manager: See Own Locations</field>
        <field name="model_id" ref="stock.model_stock_location"/>
        <field name="domain_force">['|', ('warehouse_id.keeper_id', '=', user.id), ('warehouse_id.manager_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_warehouse_keeper'))]"/>
    </record>

    <!-- Record Rules for Stock Picking Type -->
    <record id="rule_stock_picking_type_keeper_see_own" model="ir.rule">
        <field name="name">Warehouse Keeper/Manager: See Own Picking Types</field>
        <field name="model_id" ref="stock.model_stock_picking_type"/>
        <field name="domain_force">['|', ('warehouse_id.keeper_id', '=', user.id), ('warehouse_id.manager_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_warehouse_keeper'))]"/>
    </record>

    <!-- Record Rules for Product (so they can see products in their warehouse) -->
    <record id="rule_product_product_keeper_see_all" model="ir.rule">
        <field name="name">Warehouse Keeper/Manager: See All Products</field>
        <field name="model_id" ref="product.model_product_product"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_warehouse_keeper'))]"/>
    </record>

    <record id="rule_product_template_keeper_see_all" model="ir.rule">
        <field name="name">Warehouse Keeper/Manager: See All Product Templates</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_warehouse_keeper'))]"/>
    </record>

</odoo>
